<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dino Runner</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(#87ceeb, #f0faff);
    font-family: Arial, sans-serif;
  }
  canvas { display: block; }
  .ui {
    position: fixed;
    top: 10px;
    left: 15px;
    font-weight: bold;
    font-size: 16px;
    color: #222;
  }
  .center {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-weight: bold;
    font-size: 20px;
    color: #222;
    pointer-events: none;
  }
  .hidden { display: none; }
</style>
</head>

<body>

<canvas id="game"></canvas>

<div class="ui" id="score">SCORE: 0</div>
<div class="center" id="start">PRESS SPACE / TAP TO START</div>
<div class="center hidden" id="over">GAME OVER<br>PRESS R / TAP TO RESTART</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let state = "START";
let score = 0;
let speed = 7;
let gravity = 0.9;
let frame = 0;

const dino = {
  x: 80,
  y: 0,
  w: 40,
  h: 50,
  vy: 0,
  jumping: false,
  duck: false
};

const ground = () => canvas.height * 0.75;
let obstacles = [];

function spawnObstacle() {
  const isBird = Math.random() < 0.3;

  let obs = {
    x: canvas.width + 20,
    y: 0,
    w: 0,
    h: 0,
    type: isBird ? "bird" : "cactus"
  };

  if (isBird) {
    obs.w = 55;
    obs.h = 90;
    obs.y = ground() - 25 - obs.h - 6;
  } else {
    obs.w = Math.random() < 0.5 ? 25 : 40;
    obs.h = Math.random() < 0.5 ? 40 : 60;
    obs.y = ground() - obs.h;
  }

  obstacles.push(obs);
}

function jump() {
  if (!dino.jumping) {
    dino.vy = -16;
    dino.jumping = true;
  }
}

/* KEYBOARD */
document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    if (state === "START") start();
    if (state === "RUNNING") jump();
  }
  if (e.code === "ArrowDown") dino.duck = true;
  if (e.code === "KeyR" && state === "OVER") start();
});

document.addEventListener("keyup", e => {
  if (e.code === "ArrowDown") dino.duck = false;
});

/* MOBILE TOUCH + SWIPE */
let touchStartY = 0;
let isSwipingDown = false;

canvas.addEventListener("touchstart", e => {
  touchStartY = e.touches[0].clientY;

  if (state === "START") start();
  else if (state === "RUNNING") jump();
  else if (state === "OVER") start();
});

canvas.addEventListener("touchmove", e => {
  const currentY = e.touches[0].clientY;
  if (currentY - touchStartY > 30) {
    dino.duck = true;
    isSwipingDown = true;
  }
});

canvas.addEventListener("touchend", () => {
  if (isSwipingDown) {
    dino.duck = false;
    isSwipingDown = false;
  }
});

function start() {
  state = "RUNNING";
  score = 0;
  speed = 7;
  frame = 0;
  obstacles = [];
  dino.y = ground() - dino.h;
  dino.vy = 0;
  dino.jumping = false;
  dino.duck = false;
  document.getElementById("start").classList.add("hidden");
  document.getElementById("over").classList.add("hidden");
}

function gameOver() {
  state = "OVER";
  document.getElementById("over").classList.remove("hidden");
}

/* Duck-aware collision */
function hit(a, b) {
  const ah = a.duck ? a.h / 2 : a.h;
  const ay = a.y + (a.h - ah);

  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    ay < b.y + b.h &&
    ay + ah > b.y
  );
}

function update() {
  if (state !== "RUNNING") return;

  frame++;
  score++;
  speed += 0.002;

  if (frame % 70 === 0) spawnObstacle();

  dino.vy += gravity;
  dino.y += dino.vy;

  if (dino.y >= ground() - dino.h) {
    dino.y = ground() - dino.h;
    dino.vy = 0;
    dino.jumping = false;
  }

  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.w > 0);

  obstacles.forEach(o => {
    if (hit(dino, o)) gameOver();
  });

  document.getElementById("score").innerText = "SCORE: " + score;
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
  sky.addColorStop(0, "#87CEEB");
  sky.addColorStop(1, "#FFFFFF");
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  /* BACKGROUND TEXT */
  ctx.save();
  ctx.globalAlpha = 0.15;
  ctx.fillStyle = "#000";
  ctx.font = "bold 48px Arial";
  ctx.textAlign = "center";
  ctx.fillText("MADE BY NIKHIL", canvas.width / 2, canvas.height / 2);
  ctx.restore();

  ctx.fillStyle = "#FFD93D";
  ctx.beginPath();
  ctx.arc(canvas.width - 90, 90, 35, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = "#E3C16F";
  ctx.fillRect(0, ground(), canvas.width, canvas.height);

  ctx.strokeStyle = "#2ECC71";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(0, ground());
  ctx.lineTo(canvas.width, ground());
  ctx.stroke();

  ctx.fillStyle = "#27AE60";
  let dh = dino.duck ? dino.h / 2 : dino.h;
  ctx.fillRect(dino.x, dino.y + (dino.h - dh), dino.w, dh);

  ctx.fillStyle = "#000";
  ctx.fillRect(dino.x + 25, dino.y + 10, 5, 5);

  obstacles.forEach(o => {
    ctx.fillStyle = o.type === "bird" ? "#E74C3C" : "#1E8449";
    ctx.fillRect(o.x, o.y, o.w, o.h);
  });
}

function loop() {
  requestAnimationFrame(loop);
  update();
  draw();
}
loop();
</script>

</body>
</html>
